<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Validator Test</title>
    <script language="JavaScript" src="validator.js"></script>
    <script language="JavaScript">
      var v = Validator;

      v.summit_callback = function() {
        var str = "";
        var error_items = v.get_error_items();
        for(var i in error_items) {
          str += error_items[i].message + "\n";
        }
        alert(str);
      };

      v.callback = function(item, value) {
        var tar = document.getElementById(item.id + '_status');

        if(!item.corrected) {
          tar.innerHTML = item.message;
        } else {
          tar.innerHTML = 'valid';
        }
      };

      Validator.add_rule('date', {
        shoulda : function(value, pattern) {
          var regex = /^\d{4}-(0?[1-9]|1[0-2])-(0?[1-9]|[1-2]\d|3[0-1])$/;
          return regex.test(value);
        },
        message : "{alias}不是有效的的日期格式。"
      });
      
      var min_size_pattern = {
        validates : ['size'],
        size : {
          minimium : 4
        }
      };

      // v.ensure({
      // 'item1' : '字段1',
      // 'item2' : '字段2'
      // }, {
      // validates : ['size'],
      // size : {
      // minimium : 6
      // },
      // });

      v.ensure({
        'item1' : '字段1'
      }, {
        validates : ['presence']
      });
      v.ensure({
        'item2' : '字段2'
      }, min_size_pattern);
      v.ensure({
        'item3' : '字段3'
      }, {
        validates : ['size'],
        size : {
          maximium : 6
        }
      });
      v.ensure({
        'item4' : '字段4'
      }, {
        validates : ['size'],
        size : {
          minimium : 4,
          maximium : 6
        }
      });
      v.ensure({
        'item5' : '字段5'
      }, {
        validates : ['format'],
        format : /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/,
        message : '{alias}不是有效的email地址。'
      });
      v.ensure({
        'item6' : '字段6'
      }, {
        validates : ['shoulda'],
        shoulda : function() {
          return value == 'hello'
        },
        message : '{alias}不是hello。'
      });
      v.ensure({
        'item7' : '字段7'
      }, {
        validates : ['inclusion'],
        inclusion : ['male', 'female']
      });
      v.ensure({
        'item8' : '字段8'
      }, {
        validates : ['presence', 'exclusion'],
        exclusion : ['nil', 'null']
      });
      v.ensure({
        'item9' : '字段9'
      }, {
        validates : ['date']
      });
    </script>
  </head>
  <body>
    <form action="#" method="get" id="test_form" onsubmit="return v.check_form()">
      <label> not empty:
        <input type="text" name="item1" id="item1" onblur="v.check(this)"/>
        <i id="item1_status"></i> </label>
      <br />
      <label> more than 4:
        <input type="text" name="item2" id="item2" onblur="v.check(this)"/>
        <i id="item2_status"></i> </label>
      <br />
      <label> less than 6:
        <input type="text" name="item3" id="item3" onblur="v.check(this)"/>
        <i id="item3_status"></i> </label>
      <br />
      <label> between 4 and 6:
        <input type="text" name="item4" id="item4" onblur="v.check(this)"/>
        <i id="item4_status"></i> </label>
      <br />
      <label> custom regex:
        <input type="text" name="item5" id="item5" onblur="v.check(this)"/>
        <i id="item5_status"></i> </label>
      <br />
      <label> by function:
        <input type="text" name="item6" id="item6" onblur="v.check(this)"/>
        <i id="item6_status"></i> </label>
      <br />
      <label> inclusion:
        <input type="text" name="item7" id="item7" onblur="v.check(this)"/>
        <i id="item7_status"></i> </label>
      <br />
      <label> exclusion:
        <input type="text" name="item8" id="item8" onblur="v.check(this)"/>
        <i id="item8_status"></i> </label>
      <br />
      <label> custom(date):
        <input type="text" name="item9" id="item9" onblur="v.check(this)"/>
        <i id="item9_status"></i> </label>
      <br />
      <input type="submit" />
    </form>
  </body>
</html>
